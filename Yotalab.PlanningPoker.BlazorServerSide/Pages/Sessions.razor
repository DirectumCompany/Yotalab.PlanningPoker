@page "/"

@inherits AuthorizedOwningComponentBase<SessionService>
@inject NavigationManager NavigationManager

<MudText Typo="Typo.h4" Align="Align.Center">Мои сессии</MudText>
<div class="mt-2"></div>
@if (this.sessions != null)
{
  <div class="w-75 m-auto">
    <MudPaper>
      @if (this.sessions.Count > 0)
      {
        <MudTable Items="this.sessions" Hover="true" Breakpoint="Breakpoint.Sm" Dense="true">
          <RowTemplate>
            <MudTd>
              <div class="d-flex align-items-center">
                <div class="flex-fill"
                     style="cursor:pointer"
                     @onclick="@(() => NavigationManager.NavigateTo($"sessions/{context.Id}"))">
                  @context.Name
                  @if (context.ProcessingState == Grains.Interfaces.Models.SessionProcessingState.Started)
                  {
                    <MudChip Label="true" Style="cursor:pointer" Class="ms-2" Color="Color.Error" Size="Size.Small">Голосование идет</MudChip>
                  }
                </div>
                <div>
                  @if (context.ModeratorIds.Contains(this.ParticipantId))
                  {
                    <MudChip Label="true" Style="cursor:pointer" Class="me-2" Color="Color.Primary" Size="Size.Small">Вы модератор</MudChip>
                  }
                  <MudChip Label="true" Style="cursor:pointer" Color="Color.Success" Size="Size.Small">участников: @context.ParticipantsCount</MudChip>
                </div>
                <div class="ms-2">
                  @if (context.ModeratorIds.Contains(this.ParticipantId))
                  {
                    var sessionContextMenuItems = new List<DropDownMenuItem>();
                    sessionContextMenuItems.Add(new DropDownMenuItem()
                    {
                      ItemTemplate =
                      @<button class="dropdown-item"
                               @onclick="@(() => this.ShowRemoveSessionConfirmation(context.Id))">
                        <span class="oi oi-trash text-danger me-2"></span>Удалить
                      </button>
                    });

                    <DropDownMenu Items="sessionContextMenuItems">
                      <ButtonTemplate>
                        <button class="btn btn-sm p-0 m-0 ps-1 pe-1">
                          <span class="oi oi-ellipses"></span>
                        </button>
                      </ButtonTemplate>
                    </DropDownMenu>
                  }
                </div>
              </div>
            </MudTd>
          </RowTemplate>
        </MudTable>
      }
      else
      {
        <MudList Clickable="true">
          <MudListItem Text="Сессий нет" />
        </MudList>
      }
    </MudPaper>

    <div class="float-end p-4 pe-3">
      <MudFab Color="Color.Primary" Icon="@Icons.Material.Filled.Add" @onclick="this.OnShowCreationModal" />
    </div>
  </div>
}
else
{
  <div class="d-flex justify-content-center">
    <div class="spinner-grow text-info" role="status">
      <span class="visually-hidden">Загрузка...</span>
    </div>
  </div>
}
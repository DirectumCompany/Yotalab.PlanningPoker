@page "/identity/login/{returnUrl?}"
@layout IdentityLayout

<MudCard Class="login-card">
  <MudCardContent>
    <MudText Align="Align.Center" Class="mb-10" Typo="Typo.h4">
      <Logotype />
    </MudText>
    <MudText Typo="Typo.h6" Class="mb-3">
      Входите, пожалуйста
    </MudText>
    <MudFocusTrap>
      <EditForm @bind-IsValid="@success" @bind-Errors="@errors" Model="this.loginInputModel" OnSubmit="this.SignIn" class="login-form">
        <DataAnnotationsValidator />
        <MudTextField @bind-Value="this.loginInputModel.Email" Label="Эл. почта"
                      For="@(() => this.loginInputModel.Email)"
                      InputType="InputType.Email"
                      Required="true"
                      RequiredError="Введите эл. почту" />
        <MudTextField @bind-Value="this.loginInputModel.Password" Label="Пароль"
                      For="@(() => this.loginInputModel.Password)"
                      InputType="InputType.Password"
                      Required="true"
                      RequiredError="Введите пароль" />
        <div class="d-flex mt-3">
          <MudCheckBox @bind-Checked="this.loginInputModel.RememberMe" Label="Запомнить меня?"
                       Class="ml-n2" Color="Color.Info"
                       For="@(() => this.loginInputModel.RememberMe)"/>
          <MudSpacer />
          <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Disabled="@(!success)" Class="ml-auto align-self-center">Войти</MudButton>
        </div>
      </EditForm>
    </MudFocusTrap>
  </MudCardContent>
  <MudCardActions>
    @if (this.ExternalLogins != null)
    {
      <form id="external-account" action="./ExternalLogin?returnUrl=@this.GetReturnUrl()" method="post" class="d-flex justify-space-around flex-grow-1 mt-5 mb-3">
        @foreach (var provider in this.ExternalLogins)
        {
          string icon = null;
          switch (provider.Name.ToLower())
          {
            case "microsoft":
              icon = Icons.Custom.Brands.Microsoft;
              break;
            case "google":
              icon = Icons.Custom.Brands.Google;
              break;
          }
          <MudButton Variant="Variant.Filled" StartIcon="@icon" ButtonType="ButtonType.Submit"
                     title="@($"Войти с аккаунтом {provider.DisplayName}")">
            @provider.DisplayName
          </MudButton>
        }
      </form>
    }
  </MudCardActions>
</MudCard>
